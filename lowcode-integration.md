# K12 教务管理系统 - 低代码能力方案（自研优先）

## 1. 目标
- 管理员可配置：临时填报表单、部分业务对象的通用增删改查（CRUD）、不同端菜单与页面可见性。
- 研发侧可控：所有数据访问必须经过本系统鉴权与数据范围校验；低代码只做“配置与渲染”，不直连数据库。
- 可演进：先落地“表单 + 通用CRUD + 菜单配置”，再逐步扩展到流程与报表。

## 2. 自研低代码的范围（MVP）
### 2.1 表单（Form）
- 适用：体温日报、报名统计、信息采集、问卷。
- 形态：管理员在管理端配置表单 schema；学生端/教师端渲染并提交。
- 字段类型（MVP）：
  - 单行文本、多行文本、数字、单选、 多选、下拉、日期、时间、图片上传、附件上传
  - 级联选择（可选增强）
- 校验（MVP）：
  - 必填、长度、数值范围、正则、日期范围、文件大小/类型
- 联动（可选增强）：
  - 条件显隐、字段联动（简单表达式）

### 2.2 通用CRUD对象（Entity）
- 适用：可配置的“台账类”功能，例如：处分记录台账、表扬记录台账、社团登记台账、校服尺码统计等。
- 形态：管理员配置实体与字段，系统自动生成列表页/表单页 schema，并提供通用CRUD接口。
- 字段类型（MVP）：
  - 文本、数字、日期、枚举字典、引用（学生/班级/年级等内置对象）
- 列表配置（MVP）：
  - 显示列、排序、过滤项、导出开关
- 权限与范围：
  - 每个实体支持配置读/写范围（年级/班级/学科/本人）
  - 写操作强审计

### 2.3 菜单与页面配置（UI Menu）
- 适用：像通用后台平台一样，让管理员直接调整不同端的菜单、入口、权限点。
- 形态：菜单树存库并可发布；菜单绑定页面类型（内置页面/通用CRUD/外链）。
- 约束：
  - 内置页面路由白名单
  - 外链必须允许配置域名白名单
  - 发布必须版本化，可回滚

## 3. 自研低代码的数据模型（概要）
### 3.1 表单元数据
- Form
  - id、name、code、status（draft/published/archived）、version、owner、createdAt
  - targetScope（可见数据范围配置：年级/班级/学科/本人）
  - uiSchema（JSON）
  - validateSchema（JSON）
- FormPublish
  - formId、version、publishedAt、publishedBy

### 3.2 表单提交数据
- FormRecord
  - id、formId、formVersion、submitterUserId、submitterRole、submittedAt
  - subjectType/subjectId（可选：关联学生/班级等主体）
  - data（JSON）
  - status（normal/void）

### 3.3 通用实体元数据与数据
- Entity
  - id、name、entityCode、status、version、owner、createdAt
  - readScopeConfig、writeScopeConfig（JSON）
- EntityField
  - entityId、fieldCode、fieldName、type、required、unique、dictCode、refType、rules（JSON）
- EntityRecord
  - entityId、recordId、data（JSON）、createdBy、createdAt、updatedBy、updatedAt、status

## 4. 自研低代码的页面清单（管理端）
### 4.1 低代码中心 - 表单
- 表单列表：新建、复制、编辑、发布、归档、权限配置、查看提交数据
- 表单设计：字段库、画布、属性面板、预览、校验配置
- 数据查看：提交记录列表、详情、导出、作废（强审计）

### 4.2 低代码中心 - 通用对象
- 对象列表：新建、复制、编辑、发布、归档、权限配置
- 字段管理：字段增删改、唯一性、字典绑定、引用对象配置
- 页面配置：列表列配置、过滤项配置、表单布局配置
- 数据管理：通用CRUD页面（按授权开放）

### 4.3 功能配置 - 菜单与页面
- 菜单树配置：端类型切换（管理/教师/学生）、新增节点、拖拽排序、绑定权限点与页面类型
- 发布与回滚：版本列表、差异预览、回滚

## 5. 安全与治理（必须）
- schema 与发布必须版本化、可回滚，所有发布与回滚强审计。
- 通用CRUD与表单记录的读写必须经过 RBAC + 数据范围校验。
- 禁止自定义SQL与直连数据库能力。
- 禁止低代码配置中出现任意脚本执行能力；联动表达式仅允许受限语法。

## 6. 仍可选的开源集成（备选）
- 若后续希望更强的拖拽编辑器，可按“组件嵌入/iframe”接入开源方案，但数据源仍必须走本系统网关与鉴权。

## 4. 推荐落地路线（从易到难）
### 4.1 第一步：低代码“渲染”先行
- 管理端提供“表单元数据”编辑（先表格化配置，后续再接拖拽编辑器）。
- 学生端/教师端使用渲染器按 schema 渲染表单，提交到本系统 API。
- 数据存储：表单提交数据进入通用记录表（按 formId 分区/按 schema 校验）。

### 4.2 第二步：通用CRUD（对象管理）
- 管理端创建对象 → 定义字段 → 发布 → 自动生成列表/表单 schema → 绑定到菜单。
- 通过 `/meta/entities/{id}/records` 提供通用增删改查；必须带审计与范围校验。

### 4.3 第三步：可选引入“开源编辑器”
- 若选型项目本身带编辑器：优先考虑“组件嵌入编辑器”而非全量 iframe。
- 若只能 iframe：采用 SSO（本系统签发一次性 token）+ 权限同步（菜单/角色映射）+ 数据源代理（平台请求全部走本系统网关）。

## 5. 安全与治理（必须）
- schema 发布必须走“审核/版本化”（至少保留历史版本，可回滚）。
- 任意低代码页面的数据源调用必须走统一的 API 客户端，自动带上 token，并在后端进行范围过滤。
- 禁止在低代码配置中出现“直连数据库/自定义SQL”能力（学校数据敏感）。

# K12 教务管理系统 - PRD（页面、菜单、交互与数据接入点）

## 1. 目标与边界
### 1.1 产品目标
- 面向初高中（K12）的教务与德育一体化管理，核心能力为成绩/德育数据沉淀、分层分析、预警与闭环处置。
- 以“角色 + 数据范围”为核心的权限体系，实现同一页面在不同用户下呈现不同能力与数据。
- 提供低代码能力，支撑临时性填报与轻量流程，避免大量定制开发。

### 1.2 不做/弱化
- 不做大学选课、学分制教务流程。
- 不做教室资源调度、宿舍平面图交互看板；宿舍相关以“量化统计 + 事件明细 + 分布滚动屏”为主。

## 2. 角色与使用场景
### 2.1 角色清单
- 系统管理员：人员组织、权限与规则、低代码发布、安全审计。
- 校级管理员/领导：跨年级查看（按授权），关注总览指标、预警、审批。
- 年级管理员：考务与成绩导入、年级分析、德育规则与统计、宿舍量化统计。
- 班主任：学生画像、班级分析、临界生与预警、德育事件处置、审批。
- 科任老师：任教学科与行政班分析、课堂德育事件录入/复核、通知。
- 学生：查成绩、看德育、填报、消息。

### 2.2 关键原则：数据范围优先
- 同一“成绩分析”页面：年级管理员看到全年级班级对比；班主任只看到本班；科任老师只看到任教学科且仅限所授行政班；学生仅看到本人。

## 3. 终端形态与信息架构
### 3.1 终端形态
- 管理端（PC Web）：系统管理员/校级/年级管理员使用。
- 教师端（PC Web）：班主任/科任老师使用。
- 学生（移动端）：查询、通知、填报。
- 内部分布屏（TV/大屏）：滚动播报关键指标与预警（只读）。

### 3.2 全局通用交互（PC 端）
- 顶部条：学年学期切换、年级切换（按权限显示）、全局搜索学生（按数据范围）。
- 左侧菜单：按“菜单权限”动态渲染；菜单下的按钮按“功能权限”控制显隐/可用。
- 数据过滤：默认过滤当前学期；支持选择考试批次、班级、科目等（按角色开放不同过滤项）。

### 3.3 视觉与交互规范（高优先级）
- 本PRD只约束“必须达成的体验目标与一致性规则”；完整设计系统见：[design-system.md](file:///c:/Users/14590/Desktop/%E6%95%99%E5%8A%A12/design-system.md)，页面线框与交互见：[ui-design.md](file:///c:/Users/14590/Desktop/%E6%95%99%E5%8A%A12/ui-design.md)。
- 风格目标：高级现代数据风格（克制毛玻璃、清晰层级、细腻动效），不采用 Ant Design Pro 的默认视觉语言。
- 数据可读性红线：表格/图表区域优先保证对比度与信息密度，毛玻璃只用于容器与弹层，不用于表格单元格背景。
- 交互质感：所有按钮/输入/弹层必须具备 hover/pressed/focus/loading/disabled 状态；高风险操作必须二次确认并提示审计。

## 4. 页面与菜单（按端/角色）

### 4.1 登录与账号相关（所有端通用）
#### 4.1.1 登录页（PC/H5）
- 目的：账号登录、首次登录引导、找回/重置密码。
- 组件：
  - 账号（工号/学号/手机号）+ 密码
  - 图形验证码（可选开关）
  - 首次登录强制修改密码（开关）
- 数据接入点：
  - `POST /auth/login`
  - `POST /auth/password/reset`（可选：管理员重置；短信后续再加）
  - `GET /me`（拉取角色与菜单）

#### 4.1.2 我的/账号设置
- 目的：修改密码、查看绑定关系、查看最近登录与操作摘要（可选）。
- 数据接入点：`PATCH /me/password`、`GET /me/audit/summary`

---

### 4.2 管理端（PC Web）
#### 4.2.1 菜单：工作台
- 页面：工作台
- 功能：待办审批、最近导入任务状态、异常预警摘要。
- 数据接入点：`GET /dashboard/admin`

#### 4.2.2 菜单：组织与人员
1) 年级/班级管理
- 关键动作：新增/导入班级；配置班主任；配置科任老师授课班级；学期切换批量升班/分班。
- 数据接入点：
  - `GET/POST/PATCH /org/grades`
  - `GET/POST/PATCH /org/classes`
  - `POST /org/rollover`（学期升班/分班批处理）

2) 用户管理（重点：批量开通）
- 页面：用户列表、导入任务、账号状态
- 关键动作：
  - 批量导入学生账号（Excel，学号作为主键）
  - （可选）批量导入教师账号（Excel，工号作为主键）
  - 自动生成账号策略（学号/工号/自定义前缀）
  - 批量重置密码、停用/启用账号
  - 重名处理：列表与搜索默认展示“姓名 + 学号 + 班级”，导入允许同名但不允许学号冲突
- 数据接入点：
  - `POST /users/import`（上传Excel，异步任务）
  - `GET /users/import/{taskId}`（任务进度与错误行）
  - `GET /users`、`PATCH /users/{id}/status`
  - `POST /users/batch/password-reset`

#### 4.2.3 菜单：角色权限
1) 角色管理
- 动作：新建角色、复制角色、授予菜单/按钮权限。
- 数据接入点：`GET/POST/PATCH /rbac/roles`、`POST /rbac/roles/{id}/permissions`

2) 数据范围权限（关键）
- 动作：给用户授予数据范围：年级/行政班/学科/跨年级。
- 数据接入点：`POST /rbac/users/{id}/scopes`、`GET /rbac/users/{id}/scopes`

#### 4.2.4 菜单：字典与规则
- 科目库：语数英物化生政史地体音美等；支持年级差异。
- 分段规则：优秀/及格/低分阈值（可按年级/科目配置）。
- 线位配置：一本线/普高线/自定义线（用于临界生）。
- 数据接入点：`/dict/subjects`、`/rules/score-segments`、`/rules/lines`

#### 4.2.5 菜单：考务中心（年级管理员也有）
1) 考试管理
- 动作：创建考试批次、配置参与年级与科目、设置满分/权重（可选）。
- 数据接入点：`GET/POST/PATCH /exams`、`POST /exams/{id}/subjects`

2) 成绩导入与校验（重点）
- 动作：
  - 上传Excel（含：学号、姓名、班级、各科分数）
  - 预校验：缺考、重复、学号不存在、科目列不匹配、满分超限
  - 确认入库（可回滚）
  - 触发排名与分析计算任务
- 数据接入点：
  - `POST /scores/import`（异步任务）
  - `GET /scores/import/{taskId}`
  - `POST /scores/import/{taskId}/commit`
  - `POST /analytics/jobs/exam/{examId}`（计算任务）

3) 报表导出
- 动作：导出班级对比、学科分析、临界生名单、学生成绩单。
- 数据接入点：`GET /reports/...`（导出下载）

#### 4.2.6 菜单：德育量化
1) 事件录入/导入
- 来源：巡堂扣分、纪检扣分、宿舍扣分（混合宿舍支持）。
- 动作：新增事件、批量导入、撤销/更正（需审计）。
- 数据接入点：`GET/POST /moral/events`、`POST /moral/events/import`、`POST /moral/events/{id}/revoke`

2) 统计与对账
- 页面：班级扣分榜、学生扣分榜、来源对账（巡堂/纪检/宿舍）。
- 数据接入点：`GET /moral/stats/classes`、`GET /moral/stats/students`、`GET /moral/stats/sources`

#### 4.2.7 菜单：低代码中心
1) 表单管理
- 动作：创建表单（拖拽）、发布、设置可见角色与数据范围、查看回收数据。
- 数据接入点：`GET/POST/PATCH /lowcode/forms`、`POST /lowcode/forms/{id}/publish`、`GET /lowcode/forms/{id}/records`

2) 流程管理（可选增强）
- 动作：配置审批流、绑定到表单或业务类型（请假/处分/表扬）。
- 数据接入点：`/lowcode/workflows`

#### 4.2.8 菜单：安全审计
- 页面：登录日志、成绩修改日志、权限变更日志、导入任务日志。
- 数据接入点：`GET /audit/logs`

#### 4.2.9 菜单：功能配置（平台化能力）
1) 菜单与页面配置
- 目标：管理员在管理端直接配置不同端（管理端/教师端/学生端）的菜单树、路由与可见角色。
- 动作：新增菜单、调整层级、绑定权限点、绑定页面类型（固定页面/通用CRUD页面/外链页面）。
- 数据接入点：`GET/POST/PATCH /ui/menus`

2) 通用CRUD（对象管理）
- 目标：管理员可对“部分功能”直接配置增删改查，不需要研发介入。
- 动作：新增业务对象（字段、校验、列表列配置、表单配置）、发布、授权给角色/范围。
- 数据接入点：`GET/POST/PATCH /meta/entities`、`POST /meta/entities/{id}/publish`、`/meta/entities/{id}/records`

---

### 4.3 教师端（PC Web）
#### 4.3.1 菜单：工作台
- 页面：我的班级入口、待审批、预警摘要（临界生/高频扣分）。
- 数据接入点：`GET /dashboard/teacher`

#### 4.3.2 菜单：班主任（仅班主任可见）
1) 班级管理
- 内容：学生名单、座位号、宿舍信息摘要（楼栋/房间/床位）、状态（走读/住校）。
- 动作：班主任可直接修改可变信息（座位号、宿舍、走读/住校等），所有修改留痕审计。
- 数据接入点：`GET /classes/{id}/students`、`PATCH /students/{id}/profile`

2) 学生档案 360
- 内容：基础信息 + 学期档案回溯 + 成绩趋势 + 德育时间轴 + 标签（临界生/偏科）。
- 数据接入点：`GET /students/{id}`、`GET /students/{id}/profiles`、`GET /students/{id}/scores`、`GET /students/{id}/moral-events`

3) 班级分析（核心）
- 指标：均分、优秀人数/率、及格人数/率、低分人数/率、分段构成、学科薄弱点、临界生列表。
- 过滤：考试批次、科目（班主任可看全科）。
- 数据接入点：`GET /analytics/class`、`GET /analytics/class/segments`、`GET /analytics/class/borderline`

4) 德育管理
- 内容：按来源对账、扣分明细、学生累计分，支持处置（谈话记录/处分流程）。
- 数据接入点：`GET /moral/events`、`GET /moral/stats/...`、`POST /discipline/cases`（可选）

5) 审批中心
- 内容：请假、处分/表扬、各类申请（来自低代码流程）。
- 数据接入点：`GET /approvals/inbox`、`POST /approvals/{id}/action`

#### 4.3.3 菜单：任教（科任老师）
1) 成绩分析（任教学科）
- 内容：所授行政班对比、分段、薄弱题型/板块（若后续接题库可扩展）。
- 数据接入点：`GET /analytics/subject/classes`、`GET /analytics/subject/segments`

2) 德育事件（课堂）
- 动作：新增扣分/加分事件、提交复核（可配置是否需要年级复核）。
- 数据接入点：`POST /moral/events`、`POST /moral/events/{id}/submit`

3) 通知发布
- 动作：发给行政班；支持附件与回执（可选）。
- 数据接入点：`POST /notices`、`GET /notices`

---

### 4.4 学生端（H5/小程序）
#### 4.4.1 Tab：首页
- 内容：公告通知、待办填报、成绩发布提醒、德育预警提醒（仅本人）。
- 数据接入点：`GET /home/feed`

#### 4.4.2 Tab：成绩
- 页面：成绩单、趋势、学科强弱
- 数据接入点：`GET /me/scores`、`GET /me/analytics/subject-balance`

#### 4.4.3 Tab：德育
- 页面：量化明细、时间轴、累计分
- 数据接入点：`GET /me/moral-events`、`GET /me/moral-summary`

#### 4.4.4 Tab：填报（低代码表单）
- 页面：表单列表、表单填写、历史记录
- 数据接入点：`GET /lowcode/forms/available`、`GET /lowcode/forms/{id}`、`POST /lowcode/forms/{id}/submit`

#### 4.4.5 Tab：我的
- 页面：个人信息摘要、密码修改
- 数据接入点：`GET /me`、`PATCH /me/password`

---

### 4.5 内部分布屏（TV/大屏滚动，只读）
- 内容模块（可配置开关与顺序）：
  - 今日德育扣分Top班级/学生
  - 德育预警学生（连续扣分、累计超阈值）
  - 成绩临界生池（按年级、按班）
  - 缺勤/迟到统计（如后续接入考勤）
- 数据接入点：`GET /display/stream`（返回分块数据与刷新间隔）

## 5. 关键流程（交互与数据）
### 5.1 批量开通账号流程（系统管理员）
1) 上传Excel（学生为主；可选教师）→ 解析预校验 → 返回错误行与修正建议
2) 确认导入 → 系统生成账号/初始密码策略 → 生成导入任务ID
3) 导入完成 → 可导出“账号清单”（含初始化方式）→ 可一键批量重置密码
4) 重名处理：导入与展示以“学号”为唯一键；同名允许存在，列表默认展示“姓名 + 学号 + 班级”

### 5.2 成绩导入与分析流程（年级管理员）
1) 创建考试 → 配置科目/满分/年级
2) 上传成绩Excel → 校验（学号/科目列/重复/缺考）→ 生成预览差异
3) 确认入库（可回滚）→ 触发排名计算与分析任务
4) 老师端/学生端按权限查看结果；班主任看到本班对比与临界生

### 5.3 德育量化流程（巡堂/纪检/宿舍）
1) 事件录入（单条/批量）→ 按规则计算加扣分 → 进入学生德育时间轴
2) 如需复核：进入年级管理员“待复核”列表 → 通过/驳回/更正（全审计）
3) 班主任查看学生累计与异常（频繁扣分）→ 发起处置流程（可选）

## 6. 权限与审计要求（概要）
- 任何“成绩写入/更正/回滚、权限变更、德育事件撤销/更正、批量导入”必须落审计日志。
- 权限分三层：菜单权限、功能权限（按钮/API）、数据范围权限（年级/班级/学科/个人）。
